# 控制台调试指南

我已经为你的智能摘要助手扩展添加了详细的控制台调试输出，帮助你排查文本抓取的问题。以下是如何查看这些调试信息的指南：

## 🔍 调试输出位置

### 1. Content Script 调试 (页面控制台)
**在任意网页上**：
- 右键点击页面 → 选择"检查" → 切换到 "Console" 标签
- 当你使用扩展功能时，会看到类似以下的输出：

```
🔍 开始提取页面内容...
📍 当前页面URL: https://example.com
📄 页面标题: Example Page
✅ 页面内容提取完成:
📊 提取结果统计: {标题: "...", URL: "...", 内容长度: 1234, 字符数: 890, 内容类型: "article", 语言: "zh"}
📝 提取的内容预览: Lorem ipsum dolor sit amet...
```

### 2. Side Panel 调试 (侧边栏控制台)
**在侧边栏中**：
- 打开扩展侧边栏
- 在侧边栏空白处右键 → 选择"检查元素"
- 切换到 "Console" 标签
- 你会看到：

```
🚀 [Side Panel] 开始执行页面内容提取...
📦 [Side Panel] 内容提取脚本执行完成，处理结果...
📋 [Side Panel] 提取结果: {是否有结果: true, 内容长度: 1234, 标题: "...", 字数: 890}
✅ [Side Panel] 页面内容提取成功，准备发送给AI处理...
```

### 3. Service Worker 调试 (扩展后台)
**在扩展管理页面**：
- 访问 `chrome://extensions/`
- 找到你的扩展，点击 "详情"
- 在扩展详情页面，点击 "Service Worker" 链接
- 在打开的控制台中查看后台调试信息

## 📋 调试信息详解

### 页面内容提取流程

1. **ContentExtractor.extractPageContent 开始执行**
   ```
   🚀 ContentExtractor.extractPageContent 开始执行
   📄 页面基本信息: {title: "页面标题", url: "页面URL"}
   ```

2. **主要内容提取尝试**
   ```
   🔍 尝试选择器: main
   📍 找到 1 个匹配元素
   📄 元素 1 提取文本长度: 1234
   ✅ 选择器 "main" 提取成功，文本长度: 1234
   📝 提取内容预览: 这是页面的主要内容...
   ```

3. **内容清理和统计**
   ```
   🧹 开始清理内容...
   ✨ 内容清理完成: {清理前长度: 1500, 清理后长度: 1234}
   🎉 页面内容提取完成: {标题: "...", 内容长度: 1234, 字符数: 890, 内容类型: "article", 语言: "zh"}
   ```

### 选中内容提取流程

1. **选中内容检测**
   ```
   🖱️ 开始提取选中内容...
   🔍 选择对象状态: {是否有选择: true, 选择范围数量: 1, 原始选中文本长度: 150}
   ```

2. **内容处理结果**
   ```
   ✅ 选中内容提取完成:
   📊 选中内容统计: {内容长度: 145, 字符数: 98, 语言: "zh"}
   📝 选中内容预览: 用户选中的这段文字...
   ```

## 🛠️ 常见问题排查

### 问题1: 页面内容提取为空
**查看以下调试信息**：
```
❌ 所有选择器都未能提取到足够的内容
⚠️ 主要内容不足，使用备用提取方法...
```
**可能原因**：页面结构特殊，需要添加特定的CSS选择器

### 问题2: 选中内容无法识别
**查看以下调试信息**：
```
❌ 没有有效的选择对象
⚠️ 没有检测到选中内容
```
**可能原因**：页面没有文本选中，或选中的是不可提取的元素

### 问题3: 内容过长被截断
**查看以下调试信息**：
```
✨ 内容清理完成: 原始长度: 80000 → 清理后长度: 50000
```
**说明**：内容自动截断到50000字符限制

## 🎯 使用建议

1. **测试不同网站**：在不同类型的网站上测试，观察选择器的匹配情况
2. **监控性能**：注意内容提取的时间和字符数统计
3. **验证内容质量**：检查提取的内容预览，确认是否为页面主要内容
4. **调试API调用**：通过控制台输出验证发送给AI的内容是否正确

## 🔧 自定义调试

你可以在控制台中手动调用以下函数进行调试：
```javascript
// 测试页面内容提取
window.smartSummaryContentScript.extractPageContent();

// 测试选中内容提取  
window.smartSummaryContentScript.extractSelection();
```

现在你可以加载更新后的扩展，在各种网站上测试，通过控制台输出来排查内容抓取的问题！