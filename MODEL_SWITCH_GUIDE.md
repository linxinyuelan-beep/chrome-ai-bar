# 模型显示与快捷切换功能指南

## 功能概述

在摘要页面新增了AI模型显示和快捷切换功能，支持：
- 显示当前使用的AI模型信息
- 一键切换不同AI模型重新生成摘要
- 支持多AI配置管理

## 功能详情

### 1. 模型信息显示

在摘要内容区域的顶部，会显示生成该摘要所使用的AI模型信息：

```
使用模型：OpenAI - gpt-4
```

信息格式：`提供商名称 - 模型名称`

### 2. 快捷切换模型

当你配置了多个AI提供商时，会在模型信息旁边看到"切换模型"按钮。

**使用方法：**

1. 点击"切换模型"按钮
2. 从下拉菜单中选择想要使用的其他AI模型
3. 系统自动使用新模型重新生成摘要
4. 新摘要会保存到历史记录中

**下拉菜单显示内容：**
- 配置名称（用户自定义）
- 提供商和模型详情

### 3. 重新生成逻辑

切换模型后，系统会：

**页面摘要：**
- 重新提取当前页面内容
- 使用新模型生成摘要

**选中内容摘要：**
- 尝试获取当前页面的选中内容
- 如果无法获取，提示用户

## 数据结构变更

### SummaryResult 类型

新增了三个字段来存储AI配置信息：

```typescript
interface SummaryResult {
  // ... 原有字段
  aiConfigId?: string;    // AI配置ID
  aiProvider?: string;    // AI提供商名称（如 'openai', 'claude', 'gemini'）
  aiModel?: string;       // AI模型名称（如 'gpt-4', 'claude-3-sonnet'）
}
```

### 兼容性

- 历史摘要记录如果没有AI配置信息，会显示"未知模型"
- 不影响现有功能的正常使用

## UI/UX 设计

### 视觉样式

- **模型信息区域**：浅色背景，与摘要内容区分
- **模型标签**：带有主题色边框和背景的标签样式
- **切换按钮**：主题色边框，悬停时高亮显示
- **下拉菜单**：卡片式设计，包含阴影效果

### 交互设计

- 切换按钮在生成中时自动禁用
- 下拉菜单点击外部自动关闭
- 只显示已配置API密钥的AI配置
- 当前使用的模型会从列表中排除

## 使用场景

### 场景1：对比不同AI模型的摘要效果

1. 使用默认模型生成摘要
2. 点击"切换模型"，选择另一个模型
3. 对比两个摘要的质量和风格
4. 在历史记录中保留了所有版本

### 场景2：针对不同内容类型使用不同模型

- 技术文档：使用 Claude（擅长长文本理解）
- 新闻资讯：使用 GPT-4（平衡性好）
- 学术论文：使用特定配置的模型

### 场景3：成本优化

- 简单内容：使用较便宜的模型（如 GPT-3.5）
- 复杂内容：切换到更强大的模型（如 GPT-4）

## 技术实现

### 核心组件

1. **SummaryContainer.tsx**
   - 显示模型信息
   - 渲染切换按钮和下拉菜单
   - 处理模型切换交互

2. **App.tsx**
   - `handleRegenerateWithModel` 函数处理重新生成逻辑
   - 在所有摘要生成点添加AI配置信息

3. **styles.css**
   - `.summary-model-info` - 模型信息容器
   - `.model-switch-btn` - 切换按钮样式
   - `.model-menu` - 下拉菜单样式

### API 调用流程

```
用户点击切换模型
    ↓
选择新的AI配置
    ↓
根据摘要类型重新获取内容
    ↓
使用新AI配置调用生成API
    ↓
流式显示新摘要
    ↓
保存到历史记录
    ↓
更新UI显示
```

## 注意事项

1. **选中内容摘要的限制**：
   - 切换模型时需要页面仍有选中内容
   - 如果选中内容已清除，会提示错误

2. **API配置要求**：
   - 只有配置了API密钥的AI配置才会显示在列表中
   - 至少需要配置2个AI提供商才会显示切换按钮

3. **历史记录**：
   - 每次切换模型都会生成新的摘要记录
   - 原摘要保留在历史记录中

## 测试建议

### 测试步骤

1. **配置多个AI提供商**
   - 进入设置页面
   - 添加至少2个不同的AI配置
   - 确保都填写了有效的API密钥

2. **生成页面摘要**
   - 打开任意网页
   - 点击"摘要整页"
   - 等待摘要生成完成

3. **检查模型显示**
   - 确认摘要下方显示了使用的模型信息
   - 确认显示了"切换模型"按钮

4. **测试模型切换**
   - 点击"切换模型"按钮
   - 选择另一个AI配置
   - 等待新摘要生成
   - 对比两个摘要的差异

5. **验证历史记录**
   - 打开历史记录面板
   - 确认两个摘要都已保存
   - 确认每个摘要都显示了对应的模型信息

## 未来优化方向

1. **智能推荐**：根据内容类型自动推荐最适合的模型
2. **成本显示**：显示每个模型的预估成本
3. **性能对比**：记录不同模型的生成速度和质量评分
4. **批量对比**：一次性使用所有模型生成摘要，方便对比
5. **模型预设**：为不同场景配置默认使用的模型

## 相关文件

- `/src/types/index.ts` - 类型定义
- `/src/components/SummaryContainer.tsx` - 摘要容器组件
- `/src/sidepanel/App.tsx` - 主应用逻辑
- `/src/sidepanel/styles.css` - 样式定义
- `/src/utils/ai-service.ts` - AI服务封装
- `/src/utils/storage-manager.ts` - 存储管理

## 问题反馈

如遇到问题，请检查：
1. 是否配置了多个有效的AI提供商
2. API密钥是否正确
3. 网络连接是否正常
4. 浏览器控制台是否有错误信息
